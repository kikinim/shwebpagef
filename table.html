<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>설화스터디 📊 통합 공부 그래프</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Pretendard', sans-serif;
      padding: 20px;
      background: #fdfdfd;
    }
    h1, h2 {
      color: #333;
    }
    canvas {
  display: block;
  width: 100%;         /* 💡 전체 너비 채우기 */
  height: 300px;       /* 높이는 고정 */
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 0 10px rgba(0,0,0,0.05);
  margin-bottom: 40px;
}
  </style>
</head>
<body>
  <h1>설화스터디 공부 통계</h1>

  <h2>1. 날짜별 순공시간</h2>
  <canvas id="studyChart"  height="300"></canvas>

  <h2>2. 날짜별 수행평가 시간</h2>
  <canvas id="evalChart"  height="300"></canvas>

  <h2>3. 날짜별 과목별 플랜 수</h2>
  <canvas id="planChart"  height="300"></canvas>

  <h2>4. 과목별 전체 플랜 수</h2>
  <canvas id="subjectChart"  height="300"></canvas>

  <!-- 5. 과목별 모의고사 점수 변화 -->
  <h2>5. 과목별 모의고사 점수 변화</h2>
   <h2>국어</h2>
  <canvas id="score_korean"></canvas>
   <h2>영어</h2>
  <canvas id="score_english"></canvas>
   <h2>수학</h2>
  <canvas id="score_math"></canvas>
   <h2>사회</h2>
  <canvas id="score_social"></canvas>
   <h2>과학</h2>
  <canvas id="score_science"></canvas>

  <script>
    async function fetchAndDraw() {
      const studyData = await (await fetch('public/study_time.json')).json();
      const evalData = await (await fetch('public/eval_time.json')).json();
      const planData = await (await fetch('public/plan_count.json')).json();
      const subjectData = await (await fetch('public/subject_plan_count.json')).json();

      const pastelColors = [
        '#f7b5c7', '#f7d794', '#c8d6e5', '#d1ccc0', '#f3a683', '#778beb'
      ];

      // 1. 날짜별 순공시간
      new Chart(document.getElementById("studyChart"), {
        type: 'bar',
        data: {
          labels: studyData.map(d => d["날짜"]),
          datasets: [{
            label: "순공시간",
            data: studyData.map(d => d["순공시간"]),
            backgroundColor: pastelColors[0]
          }]
        },
        options: { responsive: true, scales: { y: { beginAtZero: true } } }
      });

      // 2. 수행평가 시간
      new Chart(document.getElementById("evalChart"), {
        type: 'bar',
        data: {
          labels: evalData.map(d => d["날짜"]),
          datasets: [{
            label: "수행평가 시간",
            data: evalData.map(d => d["순공시간_수행평가"]),
            backgroundColor: pastelColors[1]
          }]
        },
        options: { responsive: true, scales: { y: { beginAtZero: true } } }
      });

      // 3. 날짜별 과목별 플랜 수
      const dates = [...new Set(planData.map(d => d["날짜"]))];
      const subjects = [...new Set(planData.map(d => d["과목"]))];
      const datasets = subjects.map((subj, i) => ({
        label: subj,
        data: dates.map(date =>
          planData.find(d => d["날짜"] === date && d["과목"] === subj)?.["플랜수"] || 0),
        backgroundColor: pastelColors[i % pastelColors.length],
        stack: "stack1"
      }));

      new Chart(document.getElementById("planChart"), {
        type: 'bar',
        data: { labels: dates, datasets },
        options: {
          responsive: true,
          plugins: { title: { display: false } },
          scales: {
            x: { stacked: true },
            y: { stacked: true, beginAtZero: true }
          }
        }
      });

      // 4. 과목별 전체 플랜 수
      new Chart(document.getElementById("subjectChart"), {
        type: 'bar',
        data: {
          labels: subjectData.map(d => d["과목"]),
          datasets: [{
            label: '플랜 수',
            data: subjectData.map(d => d["플랜수"]),
            backgroundColor: pastelColors.slice(0, subjectData.length)
          }]
        },
        options: {
          responsive: true,
          scales: { y: { beginAtZero: true, ticks: { precision: 0 } } }
        }
      });

      // 5. 과목별 점수 변화 그래프
      const mockExamData = [
        { 과목: "국어", 원점수: 87, 표준점수: 105, 백분위: 90, 등급: 1, 날짜: "2025-03-01" },
        { 과목: "국어", 원점수: 91, 표준점수: 109, 백분위: 93, 등급: 1, 날짜: "2025-06-01" },
        { 과목: "국어", 원점수: 63, 표준점수: 97,  백분위: 72, 등급: 2, 날짜: "2025-09-01" },
        { 과목: "국어", 원점수: 74, 표준점수: 100, 백분위: 83, 등급: 2, 날짜: "2025-11-01" },
        { 과목: "영어", 원점수: 66, 표준점수: 98,  백분위: 78, 등급: 2, 날짜: "2025-03-01" },
        { 과목: "영어", 원점수: 53, 표준점수: 89,  백분위: 61, 등급: 3, 날짜: "2025-06-01" },
        { 과목: "영어", 원점수: 48, 표준점수: 85,  백분위: 57, 등급: 3, 날짜: "2025-09-01" },
        { 과목: "영어", 원점수: 92, 표준점수: 112, 백분위: 96, 등급: 1, 날짜: "2025-11-01" },
        { 과목: "수학", 원점수: 45, 표준점수: 87,  백분위: 55, 등급: 4, 날짜: "2025-03-01" },
        { 과목: "수학", 원점수: 78, 표준점수: 104, 백분위: 88, 등급: 2, 날짜: "2025-06-01" },
        { 과목: "수학", 원점수: 88, 표준점수: 110, 백분위: 95, 등급: 1, 날짜: "2025-09-01" },
        { 과목: "수학", 원점수: 51, 표준점수: 90,  백분위: 66, 등급: 3, 날짜: "2025-11-01" },
        { 과목: "사회", 원점수: 72, 표준점수: 102, 백분위: 85, 등급: 2, 날짜: "2025-03-01" },
        { 과목: "사회", 원점수: 41, 표준점수: 80,  백분위: 43, 등급: 4, 날짜: "2025-06-01" },
        { 과목: "사회", 원점수: 62, 표준점수: 96,  백분위: 76, 등급: 3, 날짜: "2025-09-01" },
        { 과목: "사회", 원점수: 36, 표준점수: 76,  백분위: 39, 등급: 5, 날짜: "2025-11-01" },
        { 과목: "과학", 원점수: 59, 표준점수: 95,  백분위: 70, 등급: 3, 날짜: "2025-03-01" },
        { 과목: "과학", 원점수: 68, 표준점수: 98,  백분위: 78, 등급: 2, 날짜: "2025-06-01" },
        { 과목: "과학", 원점수: 55, 표준점수: 92,  백분위: 65, 등급: 3, 날짜: "2025-09-01" },
        { 과목: "과학", 원점수: 69, 표준점수: 99,  백분위: 79, 등급: 2, 날짜: "2025-11-01" }
      ];

      const drawScoreChart = (subject, canvasId) => {
        const filtered = mockExamData.filter(d => d.과목 === subject);
        const labels = filtered.map(d => d.날짜);
        const metrics = ["원점수", "표준점수", "백분위", "등급"];
        const dataset = metrics.map((m, i) => ({
          label: m,
          data: filtered.map(d => d[m]),
          backgroundColor: pastelColors[i % pastelColors.length]
        }));

        new Chart(document.getElementById(canvasId), {
          type: 'bar',
          data: { labels, datasets: dataset },
          options: {
            responsive: true,
            plugins: { legend: { position: "top" } },
            scales: { y: { beginAtZero: true, max: 120 } }
          }
        });
      };

      drawScoreChart("국어", "score_korean");
      drawScoreChart("영어", "score_english");
      drawScoreChart("수학", "score_math");
      drawScoreChart("사회", "score_social");
      drawScoreChart("과학", "score_science");
    }

    fetchAndDraw();
  </script>
</body>
</html>
